import:
  - initialize_mongo.yaml
  - initialize_root_domain.yaml
  - initialize_repository.yaml


var:
  domain_name: root
  domain_owner: admin
  username: puppy
  mongo_init_path: $HOME/dev-initializer/init_db.js

tasks:
  - name: Create EC2 Plugin
    id: ec2_plugin
    uses: "@modules/resource"
    spec:
      resource_type: repository.Plugin
      data:
        domain_id: ${{ tasks.domain.output.domain_id }}
        name: ec2
        service_type: inventory.collector
        image: spaceone/aws-ec2
      mode: EXEC
      verb:
        exec: register
  - name: Install EC2 Plugin
    id: install_ec2_plugin
    uses: "@modules/resource"
    spec:
      resource_type: plugin.Plugin
      data:
        domain_id: ${{ tasks.domain.output.domain_id }}
        version: "1.3"
        plugin_id: ${{ tasks.ec2_plugin.output.plugin_id }}
        labels: {}
      mode: EXEC
      verb:
        exec: get_plugin_endpoint